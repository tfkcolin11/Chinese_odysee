**Refined Prompt (Version 2):**

**Project Goal:** Design specification for an interactive Mandarin Chinese language learning game powered by the Google Gemini model. The game facilitates conversational practice tailored to specific HSK levels and user proficiency within those levels, utilizing user-defined or pre-selected scenarios, and anticipating future multimodal enhancements.

**Core Concept:**

*   An AI-driven conversational game where users practice Mandarin Chinese speaking and writing skills.
*   The game adapts dynamically to the user's chosen HSK level, their demonstrated proficiency *within* that level, and the selected scenario.
*   Focuses on applying learned grammar and vocabulary in realistic conversational contexts with dynamically adjusted complexity.
*   Incorporates performance tracking, targeted feedback, personalized learning suggestions, and options for enhanced immersion.

**Key Features:**

1.  **HSK Level and Proficiency Integration:**
    *   User selects their target HSK level (1-6).
    *   This selection establishes the *baseline* vocabulary and grammar range.
    *   **Dynamic Difficulty Adjustment:** The AI continuously assesses the user's performance (leveraging data from Mastery Tracking). The actual complexity of the AI's language (vocabulary choice, sentence structure complexity) *within* the chosen HSK level range will adjust dynamically based on the user's demonstrated proficiency. If the user struggles, the AI may simplify; if the user excels, it may introduce more nuanced language appropriate to the upper end of the selected level or slightly beyond (flagging new words as needed).

2.  **Scenario Management:**
    *   **Selection:** Users can choose from a list of pre-defined scenarios.
    *   **Custom Input:** Users can define their own scenario by providing a brief description.
    *   **Scenario Goal:**
        *   For *any* selected or inputted scenario, the AI will internally determine a specific, hidden objective or desired outcome.
        *   The user's implicit goal is to navigate the conversation effectively towards achieving a logical conclusion, ideally aligning with the AI's hidden objective through proficient language use.
    *   **Saving Scenarios:**
        *   Users can save specific scenario *instances*.
        *   When reusing a saved scenario, the AI draws inspiration from the previous interaction patterns and outcomes associated with that save.

3.  **Interaction Modes & Immersion:**
    *   **Text Input:** User can type responses.
    *   **Voice Input:**
        *   User can speak responses.
        *   Speech-to-text transcription is performed.
        *   A crucial validation step allows the user to review and confirm/edit the transcription before submitting it.
    *   **AI Voice Output (TTS):**
        *   A toggleable setting (available before or during the game) allows the AI's text responses to be automatically read aloud using Text-to-Speech, enhancing the conversational feel.
    *   **(Future) Multimodal Enhancements:** The design should consider future LLM capabilities. Plan for potential integration of:
        *   More expressive AI audio output (intonation, emotion) beyond basic TTS.
        *   Visual elements (images, simple animations, or even video snippets) generated by the AI to illustrate the setting, the AI persona's reactions, or actions occurring within the scenario, further immersing the user.

4.  **AI Conversation Engine (Gemini):**
    *   **HSK-Level & Proficiency Adaptation:** Generates responses primarily using vocabulary/grammar appropriate to the selected HSK level, but dynamically adjusts complexity based on user proficiency (see point 1).
    *   **Vocabulary Flexibility & Handling:** May use vocabulary from other levels if necessary. Out-of-level words introduced by the AI are flagged and saved (with context, meaning, example) for user review.
    *   **Grammar Focus:** Aims to create conversational situations providing opportunities for practicing relevant grammar points of the target HSK level.
    *   **Contextual Understanding:** Evaluates user input for grammatical correctness, vocabulary appropriateness, and relevance to the conversational flow and hidden scenario goal.

5.  **Scoring and Feedback System:**
    *   **Performance Score:** Dynamically reflects user performance within the scenario.
    *   **Scoring Factors:** Goal Alignment (AI understanding), Grammar Accuracy, Vocabulary Appropriateness, Fluency Streaks (consecutive correct responses). Error severity impacts score reduction.
    *   **Mistake Highlighting:** Provide feedback on specific errors.

6.  **Mastery Tracking and Personalization:**
    *   **User Profile/Settings:** Tracks progress.
    *   **Granular Mastery:** Displays estimated mastery levels for individual grammar points and vocabulary within each HSK level, updated based on usage.
    *   **AI-Driven Recommendations:** Uses performance data (potentially ML-enhanced) to identify user weaknesses (specific grammar/vocab, scenario types, communicative functions).
    *   **Focused Practice:** Suggests or prompts scenarios designed to target identified weak areas, promoting fluency and confidence.

---

**Changes Incorporated:**

*   **Point 1 (HSK Level and Proficiency Integration):** Explicitly combines the HSK selection with dynamic difficulty adjustment based on the user's tracked proficiency.
*   **Point 3 (Interaction Modes & Immersion):** Added the "AI Voice Output (TTS)" toggle and the forward-looking "Multimodal Enhancements" section acknowledging future possibilities for richer media integration.
*   **Point 4 (AI Conversation Engine):** Reinforced the link between its generation logic and the dynamic difficulty scaling mentioned in Point 1.
*   Minor adjustments elsewhere for flow and consistency.

This version provides an even more robust and adaptive vision for the language learning game!Okay, excellent additions! These refinements add more dynamic adaptation and forward-thinking features. Let's integrate them seamlessly into the prompt.

Here's the updated refined prompt incorporating your points:

---

**Refined Prompt (Version 2):**

**Project Goal:** Design specification for an interactive Mandarin Chinese language learning game powered by the Google Gemini model. The game facilitates conversational practice tailored to specific HSK levels and user proficiency within those levels, utilizing user-defined or pre-selected scenarios, and anticipating future multimodal enhancements.

**Core Concept:**

*   An AI-driven conversational game where users practice Mandarin Chinese speaking and writing skills.
*   The game adapts dynamically to the user's chosen HSK level, their demonstrated proficiency *within* that level, and the selected scenario.
*   Focuses on applying learned grammar and vocabulary in realistic conversational contexts with dynamically adjusted complexity.
*   Incorporates performance tracking, targeted feedback, personalized learning suggestions, and options for enhanced immersion.

**Key Features:**

1.  **HSK Level and Proficiency Integration:**
    *   User selects their target HSK level (1-6).
    *   This selection establishes the *baseline* vocabulary and grammar range.
    *   **Dynamic Difficulty Adjustment:** The AI continuously assesses the user's performance (leveraging data from Mastery Tracking). The actual complexity of the AI's language (vocabulary choice, sentence structure complexity) *within* the chosen HSK level range will adjust dynamically based on the user's demonstrated proficiency. If the user struggles, the AI may simplify; if the user excels, it may introduce more nuanced language appropriate to the upper end of the selected level or slightly beyond (flagging new words as needed).

2.  **Scenario Management:**
    *   **Selection:** Users can choose from a list of pre-defined scenarios.
    *   **Custom Input:** Users can define their own scenario by providing a brief description.
    *   **Scenario Goal:**
        *   For *any* selected or inputted scenario, the AI will internally determine a specific, hidden objective or desired outcome.
        *   The user's implicit goal is to navigate the conversation effectively towards achieving a logical conclusion, ideally aligning with the AI's hidden objective through proficient language use.
    *   **Saving Scenarios:**
        *   Users can save specific scenario *instances*.
        *   When reusing a saved scenario, the AI draws inspiration from the previous interaction patterns and outcomes associated with that save.

3.  **Interaction Modes & Immersion:**
    *   **Text Input:** User can type responses.
    *   **Voice Input:**
        *   User can speak responses.
        *   Speech-to-text transcription is performed.
        *   A crucial validation step allows the user to review and confirm/edit the transcription before submitting it.
    *   **AI Voice Output (TTS):**
        *   A toggleable setting (available before or during the game) allows the AI's text responses to be automatically read aloud using Text-to-Speech, enhancing the conversational feel.
    *   **(Future) Multimodal Enhancements:** The design should consider future LLM capabilities. Plan for potential integration of:
        *   More expressive AI audio output (intonation, emotion) beyond basic TTS.
        *   Visual elements (images, simple animations, or even video snippets) generated by the AI to illustrate the setting, the AI persona's reactions, or actions occurring within the scenario, further immersing the user.

4.  **AI Conversation Engine (Gemini):**
    *   **HSK-Level & Proficiency Adaptation:** Generates responses primarily using vocabulary/grammar appropriate to the selected HSK level, but dynamically adjusts complexity based on user proficiency (see point 1).
    *   **Vocabulary Flexibility & Handling:** May use vocabulary from other levels if necessary. Out-of-level words introduced by the AI are flagged and saved (with context, meaning, example) for user review.
    *   **Grammar Focus:** Aims to create conversational situations providing opportunities for practicing relevant grammar points of the target HSK level.
    *   **Contextual Understanding:** Evaluates user input for grammatical correctness, vocabulary appropriateness, and relevance to the conversational flow and hidden scenario goal.

5.  **Scoring and Feedback System:**
    *   **Performance Score:** Dynamically reflects user performance within the scenario.
    *   **Scoring Factors:** Goal Alignment (AI understanding), Grammar Accuracy, Vocabulary Appropriateness, Fluency Streaks (consecutive correct responses). Error severity impacts score reduction.
    *   **Mistake Highlighting:** Provide feedback on specific errors.

6.  **Mastery Tracking and Personalization:**
    *   **User Profile/Settings:** Tracks progress.
    *   **Granular Mastery:** Displays estimated mastery levels for individual grammar points and vocabulary within each HSK level, updated based on usage.
    *   **AI-Driven Recommendations:** Uses performance data (potentially ML-enhanced) to identify user weaknesses (specific grammar/vocab, scenario types, communicative functions).
    *   **Focused Practice:** Suggests or prompts scenarios designed to target identified weak areas, promoting fluency and confidence.

---